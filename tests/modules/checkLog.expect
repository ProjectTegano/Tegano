#!/usr/bin/expect
#
# Start a the module test check the logged messages
#

set timeout 3
spawn ./moduleTest

expect 	{
	timeout		{ send_user "Process timed out.\n" }
	"DEBUG: Module: test module config created"
			{ puts "Got expected message: $expect_out(0,string)\n" }
	eof		{ puts "Got EOF before the expected message.\n"
			  exit 1
			}
}

catch wait reason
set procid [lindex $reason 0]
if { [lindex $reason 2] == 0 } {
	set retval [lindex $reason 3]
	puts "Pid $procid return code: $retval\n"
} else {
	puts "Pid $procid, some execution error occured. wait returned $reason\n"
}

if { $retval != 0 }	{
	exit 2
}
