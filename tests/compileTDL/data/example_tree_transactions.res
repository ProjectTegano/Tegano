TRANSACTION treeAddRoot
BEGIN
Code:
[0] RESULT_SET_INIT
[1] DBSTM_START STM (INSERT INTO tree (parent, name, lft, rgt) VALUES (NULL, $1, 1, 2))
[2] DBSTM_BIND_PATH PATH name
[3] DBSTM_EXEC
[4] RETURN
END

TRANSACTION treeAddNode
BEGIN
Code:
[0] RESULT_SET_INIT
[1] RESULT_CONSTRAINT_UNIQUE
[2] RESULT_CONSTRAINT_UNIQUE
[3] DBSTM_START STM (SELECT rgt FROM tree WHERE ID = $1)
[4] DBSTM_BIND_PATH PATH parentid
[5] DBSTM_EXEC
[6] RESULT_SET_INIT
[7] DBSTM_START STM (UPDATE tree SET rgt = rgt + 2 WHERE rgt >= $1)
[8] SELECT_LAST_RESULT
[9] DBSTM_BIND_SEL_IDX COLIDX 1
[10] DBSTM_EXEC
[11] RESULT_SET_INIT
[12] DBSTM_START STM (UPDATE tree SET lft = lft + 2 WHERE lft > $1)
[13] SELECT_LAST_RESULT
[14] DBSTM_BIND_SEL_IDX COLIDX 1
[15] DBSTM_EXEC
[16] RESULT_SET_INIT
[17] DBSTM_START STM (INSERT INTO tree (parent, name, lft, rgt) VALUES ($1, $2, $3, $4+1))
[18] DBSTM_BIND_PATH PATH parentid
[19] DBSTM_BIND_PATH PATH name
[20] SELECT_LAST_RESULT
[21] DBSTM_BIND_SEL_IDX COLIDX 1
[22] SELECT_LAST_RESULT
[23] DBSTM_BIND_SEL_IDX COLIDX 1
[24] DBSTM_EXEC
[25] RESULT_SET_INIT
[26] RESULT_CONSTRAINT_UNIQUE
[27] RESULT_CONSTRAINT_UNIQUE
[28] DBSTM_START STM (SELECT ID AS "ID" from tree WHERE lft = $1)
[29] SELECT_LAST_RESULT
[30] DBSTM_BIND_SEL_IDX COLIDX 1
[31] DBSTM_EXEC
[32] OPEN_ITER_LAST_RESULT
[33] NOT_IF_COND GOTO @37
[34] OUTPUT_ITR_COLUMN
[35] NEXT
[36] IF_COND GOTO @34
[37] RETURN
END

TRANSACTION treeDeleteSubtree
BEGIN
Code:
[0] RESULT_SET_INIT
[1] RESULT_CONSTRAINT_UNIQUE
[2] DBSTM_START STM (SELECT lft,rgt,rgt-lft+1 AS width FROM tree WHERE ID = $1)
[3] DBSTM_BIND_PATH PATH id
[4] DBSTM_EXEC
[5] RESULT_SET_INIT
[6] DBSTM_START STM (DELETE FROM tree WHERE lft >= $1 AND lft <= $2)
[7] SELECT_LAST_RESULT
[8] DBSTM_BIND_SEL_IDX COLIDX 1
[9] SELECT_LAST_RESULT
[10] DBSTM_BIND_SEL_IDX COLIDX 2
[11] DBSTM_EXEC
[12] RESULT_SET_INIT
[13] DBSTM_START STM (UPDATE tree SET lft = lft-$1 WHERE lft>$2)
[14] SELECT_LAST_RESULT
[15] DBSTM_BIND_SEL_IDX COLIDX 3
[16] SELECT_LAST_RESULT
[17] DBSTM_BIND_SEL_IDX COLIDX 2
[18] DBSTM_EXEC
[19] RESULT_SET_INIT
[20] DBSTM_START STM (UPDATE tree SET rgt = rgt-$1 WHERE rgt>$2)
[21] SELECT_LAST_RESULT
[22] DBSTM_BIND_SEL_IDX COLIDX 3
[23] SELECT_LAST_RESULT
[24] DBSTM_BIND_SEL_IDX COLIDX 2
[25] DBSTM_EXEC
[26] RETURN
END

TRANSACTION treeSelectNode
BEGIN
Code:
[0] RESULT_SET_INIT
[1] RESULT_CONSTRAINT_UNIQUE
[2] RESULT_CONSTRAINT_UNIQUE
[3] OPEN_ITER_PATH PATH /node
[4] NOT_IF_COND GOTO @10
[5] DBSTM_START STM (SELECT ID AS "ID",parent,name FROM tree WHERE ID = $1)
[6] DBSTM_BIND_PATH PATH id
[7] DBSTM_EXEC
[8] NEXT
[9] IF_COND GOTO @5
[10] OPEN_ITER_LAST_RESULT
[11] NOT_IF_COND GOTO @15
[12] OUTPUT_ITR_COLUMN
[13] NEXT
[14] IF_COND GOTO @12
[15] RETURN
END

TRANSACTION treeSelectNodeByName
BEGIN
Code:
[0] RESULT_SET_INIT
[1] RESULT_CONSTRAINT_UNIQUE
[2] RESULT_CONSTRAINT_UNIQUE
[3] OPEN_ITER_PATH PATH /node
[4] NOT_IF_COND GOTO @10
[5] DBSTM_START STM (SELECT ID AS "ID",parent,name FROM tree WHERE name = $1)
[6] DBSTM_BIND_PATH PATH name
[7] DBSTM_EXEC
[8] NEXT
[9] IF_COND GOTO @5
[10] OPEN_ITER_LAST_RESULT
[11] NOT_IF_COND GOTO @15
[12] OUTPUT_ITR_COLUMN
[13] NEXT
[14] IF_COND GOTO @12
[15] RETURN
END

TRANSACTION treeSelectNodeAndParents
BEGIN
Code:
[0] RESULT_SET_INIT
[1] OPEN_ITER_PATH PATH /node
[2] NOT_IF_COND GOTO @8
[3] DBSTM_START STM (SELECT P2.ID AS "ID",P2.name FROM tree AS P1, tree AS P2 WHERE P1.lft BETWEEN P2.lft AND P2.rgt AND P1.ID = $1 ORDER BY P2.ID)
[4] DBSTM_BIND_PATH PATH id
[5] DBSTM_EXEC
[6] NEXT
[7] IF_COND GOTO @3
[8] OUTPUT_OPEN_ARRAY TAG node
[9] OPEN_ITER_LAST_RESULT
[10] NOT_IF_COND GOTO @16
[11] OUTPUT_OPEN_ELEM
[12] OUTPUT_ITR_COLUMN
[13] OUTPUT_CLOSE_ELEM
[14] NEXT
[15] IF_COND GOTO @11
[16] OUTPUT_CLOSE_ARRAY
[17] RETURN
END

TRANSACTION treeSelectNodeAndParentsByName
BEGIN
Code:
[0] RESULT_SET_INIT
[1] OPEN_ITER_PATH PATH /node
[2] NOT_IF_COND GOTO @8
[3] DBSTM_START STM (SELECT P2.ID AS "ID",P2.name FROM tree AS P1, tree AS P2 WHERE P1.lft BETWEEN P2.lft AND P2.rgt AND P1.name = $1 ORDER BY P2.ID)
[4] DBSTM_BIND_PATH PATH name
[5] DBSTM_EXEC
[6] NEXT
[7] IF_COND GOTO @3
[8] OUTPUT_OPEN_ARRAY TAG node
[9] OPEN_ITER_LAST_RESULT
[10] NOT_IF_COND GOTO @16
[11] OUTPUT_OPEN_ELEM
[12] OUTPUT_ITR_COLUMN
[13] OUTPUT_CLOSE_ELEM
[14] NEXT
[15] IF_COND GOTO @11
[16] OUTPUT_CLOSE_ARRAY
[17] RETURN
END

TRANSACTION treeSelectParents
BEGIN
Code:
[0] RESULT_SET_INIT
[1] OPEN_ITER_PATH PATH /node
[2] NOT_IF_COND GOTO @8
[3] DBSTM_START STM (SELECT P2.ID AS "ID",P2.name FROM tree AS P1, tree AS P2 WHERE P1.lft > P2.lft AND P1.lft < P2.rgt AND P1.ID = $1 ORDER BY P2.ID)
[4] DBSTM_BIND_PATH PATH id
[5] DBSTM_EXEC
[6] NEXT
[7] IF_COND GOTO @3
[8] OUTPUT_OPEN_ARRAY TAG node
[9] OPEN_ITER_LAST_RESULT
[10] NOT_IF_COND GOTO @16
[11] OUTPUT_OPEN_ELEM
[12] OUTPUT_ITR_COLUMN
[13] OUTPUT_CLOSE_ELEM
[14] NEXT
[15] IF_COND GOTO @11
[16] OUTPUT_CLOSE_ARRAY
[17] RETURN
END

TRANSACTION treeSelectParentsByName
BEGIN
Code:
[0] RESULT_SET_INIT
[1] OPEN_ITER_PATH PATH /node
[2] NOT_IF_COND GOTO @8
[3] DBSTM_START STM (SELECT P2.ID AS "ID",P2.name FROM tree AS P1, tree AS P2 WHERE P1.lft > P2.lft AND P1.lft < P2.rgt AND P1.name = $1 ORDER BY P2.ID)
[4] DBSTM_BIND_PATH PATH name
[5] DBSTM_EXEC
[6] NEXT
[7] IF_COND GOTO @3
[8] OUTPUT_OPEN_ARRAY TAG node
[9] OPEN_ITER_LAST_RESULT
[10] NOT_IF_COND GOTO @16
[11] OUTPUT_OPEN_ELEM
[12] OUTPUT_ITR_COLUMN
[13] OUTPUT_CLOSE_ELEM
[14] NEXT
[15] IF_COND GOTO @11
[16] OUTPUT_CLOSE_ARRAY
[17] RETURN
END

TRANSACTION treeSelectNodeAndChildren
BEGIN
Code:
[0] RESULT_SET_INIT
[1] OPEN_ITER_PATH PATH /node
[2] NOT_IF_COND GOTO @8
[3] DBSTM_START STM (SELECT P1.ID AS "ID",P1.parent,P1.name FROM tree AS P1, tree AS P2 WHERE P1.lft BETWEEN P2.lft AND P2.rgt AND P2.ID = $1 ORDER BY P1.ID)
[4] DBSTM_BIND_PATH PATH id
[5] DBSTM_EXEC
[6] NEXT
[7] IF_COND GOTO @3
[8] OUTPUT_OPEN_ARRAY TAG node
[9] OPEN_ITER_LAST_RESULT
[10] NOT_IF_COND GOTO @16
[11] OUTPUT_OPEN_ELEM
[12] OUTPUT_ITR_COLUMN
[13] OUTPUT_CLOSE_ELEM
[14] NEXT
[15] IF_COND GOTO @11
[16] OUTPUT_CLOSE_ARRAY
[17] RETURN
END

TRANSACTION treeSelectNodeAndChildrenByName
BEGIN
Code:
[0] RESULT_SET_INIT
[1] OPEN_ITER_PATH PATH /node
[2] NOT_IF_COND GOTO @8
[3] DBSTM_START STM (SELECT P1.ID AS "ID",P1.parent,P1.name FROM tree AS P1, tree AS P2 WHERE P1.lft BETWEEN P2.lft AND P2.rgt AND P2.name = $1 ORDER BY P1.ID)
[4] DBSTM_BIND_PATH PATH name
[5] DBSTM_EXEC
[6] NEXT
[7] IF_COND GOTO @3
[8] OUTPUT_OPEN_ARRAY TAG node
[9] OPEN_ITER_LAST_RESULT
[10] NOT_IF_COND GOTO @16
[11] OUTPUT_OPEN_ELEM
[12] OUTPUT_ITR_COLUMN
[13] OUTPUT_CLOSE_ELEM
[14] NEXT
[15] IF_COND GOTO @11
[16] OUTPUT_CLOSE_ARRAY
[17] RETURN
END

TRANSACTION treeSelectChildren
BEGIN
Code:
[0] RESULT_SET_INIT
[1] OPEN_ITER_PATH PATH /node
[2] NOT_IF_COND GOTO @8
[3] DBSTM_START STM (SELECT P1.ID AS "ID",P1.name FROM tree AS P1, tree AS P2 WHERE P1.lft > P2.lft AND P1.lft < P2.rgt AND P2.ID = $1 ORDER BY P1.ID)
[4] DBSTM_BIND_PATH PATH id
[5] DBSTM_EXEC
[6] NEXT
[7] IF_COND GOTO @3
[8] OUTPUT_OPEN_ARRAY TAG node
[9] OPEN_ITER_LAST_RESULT
[10] NOT_IF_COND GOTO @16
[11] OUTPUT_OPEN_ELEM
[12] OUTPUT_ITR_COLUMN
[13] OUTPUT_CLOSE_ELEM
[14] NEXT
[15] IF_COND GOTO @11
[16] OUTPUT_CLOSE_ARRAY
[17] RETURN
END

TRANSACTION treeSelectChildrenByName
BEGIN
Code:
[0] RESULT_SET_INIT
[1] OPEN_ITER_PATH PATH /node
[2] NOT_IF_COND GOTO @8
[3] DBSTM_START STM (SELECT P1.ID AS "ID",P1.name FROM tree AS P1, tree AS P2 WHERE P1.lft > P2.lft AND P1.lft < P2.rgt AND P2.name = $1 ORDER BY P1.ID)
[4] DBSTM_BIND_PATH PATH name
[5] DBSTM_EXEC
[6] NEXT
[7] IF_COND GOTO @3
[8] OUTPUT_OPEN_ARRAY TAG node
[9] OPEN_ITER_LAST_RESULT
[10] NOT_IF_COND GOTO @16
[11] OUTPUT_OPEN_ELEM
[12] OUTPUT_ITR_COLUMN
[13] OUTPUT_CLOSE_ELEM
[14] NEXT
[15] IF_COND GOTO @11
[16] OUTPUT_CLOSE_ARRAY
[17] RETURN
END

TRANSACTION treeMoveNode
BEGIN
Code:
[0] RESULT_SET_INIT
[1] RESULT_CONSTRAINT_UNIQUE
[2] RESULT_CONSTRAINT_UNIQUE
[3] DBSTM_START STM (SELECT lft,rgt FROM tree WHERE ID = $1)
[4] DBSTM_BIND_PATH PATH newparentid
[5] DBSTM_EXEC
[6] RESULT_SET_INIT
[7] RESULT_CONSTRAINT_UNIQUE
[8] RESULT_CONSTRAINT_UNIQUE
[9] DBSTM_START STM (SELECT $1,rgt-lft AS width FROM tree WHERE ID = $2 AND NOT ($3 >= lft AND $4 < rgt))
[10] SELECT_LAST_RESULT
[11] DBSTM_BIND_SEL_IDX COLIDX 1
[12] DBSTM_BIND_PATH PATH nodeid
[13] SELECT_LAST_RESULT
[14] DBSTM_BIND_SEL_IDX COLIDX 1
[15] SELECT_LAST_RESULT
[16] DBSTM_BIND_SEL_IDX COLIDX 2
[17] DBSTM_EXEC
[18] RESULT_SET_INIT
[19] DBSTM_START STM (UPDATE tree SET rgt = rgt + $1 WHERE rgt >= $2)
[20] SELECT_LAST_RESULT
[21] DBSTM_BIND_SEL_IDX COLIDX 2
[22] SELECT_LAST_RESULT
[23] DBSTM_BIND_SEL_IDX COLIDX 1
[24] DBSTM_EXEC
[25] RESULT_SET_INIT
[26] DBSTM_START STM (UPDATE tree SET lft = lft + $1 WHERE lft > $2)
[27] SELECT_LAST_RESULT
[28] DBSTM_BIND_SEL_IDX COLIDX 2
[29] SELECT_LAST_RESULT
[30] DBSTM_BIND_SEL_IDX COLIDX 1
[31] DBSTM_EXEC
[32] RESULT_SET_INIT
[33] RESULT_CONSTRAINT_UNIQUE
[34] RESULT_CONSTRAINT_UNIQUE
[35] DBSTM_START STM (SELECT lft,rgt,rgt-lft AS width FROM tree WHERE ID = $1)
[36] DBSTM_BIND_PATH PATH newparentid
[37] DBSTM_EXEC
[38] RESULT_SET_INIT
[39] RESULT_CONSTRAINT_UNIQUE
[40] RESULT_CONSTRAINT_UNIQUE
[41] DBSTM_START STM (SELECT $1,$2,$3,lft,rgt,rgt-lft AS width FROM tree WHERE ID = $4)
[42] SELECT_LAST_RESULT
[43] DBSTM_BIND_SEL_IDX COLIDX 1
[44] SELECT_LAST_RESULT
[45] DBSTM_BIND_SEL_IDX COLIDX 2
[46] SELECT_LAST_RESULT
[47] DBSTM_BIND_SEL_IDX COLIDX 3
[48] DBSTM_BIND_PATH PATH nodeid
[49] DBSTM_EXEC
[50] RESULT_SET_INIT
[51] DBSTM_START STM (INSERT INTO TREE
		SELECT P1.ID AS "ID",
			P1.parent AS parent,
			P1.lgt-$1+$2 AS lgt,
			P1.rgt-$3+$4 AS rgt,
			P1.name AS name
		FROM tree AS P1, tree AS P2
		WHERE P1.lft BETWEEN P2.lft AND P2.rgt AND P2.ID = $5)
[52] SELECT_LAST_RESULT
[53] DBSTM_BIND_SEL_IDX COLIDX 4
[54] SELECT_LAST_RESULT
[55] DBSTM_BIND_SEL_IDX COLIDX 1
[56] SELECT_LAST_RESULT
[57] DBSTM_BIND_SEL_IDX COLIDX 5
[58] SELECT_LAST_RESULT
[59] DBSTM_BIND_SEL_IDX COLIDX 2
[60] DBSTM_BIND_PATH PATH nodeid
[61] DBSTM_EXEC
[62] RESULT_SET_INIT
[63] DBSTM_START STM (DELETE FROM tree WHERE lft >= $1 AND lft <= $2)
[64] SELECT_LAST_RESULT
[65] DBSTM_BIND_SEL_IDX COLIDX 4
[66] SELECT_LAST_RESULT
[67] DBSTM_BIND_SEL_IDX COLIDX 5
[68] DBSTM_EXEC
[69] RESULT_SET_INIT
[70] DBSTM_START STM (UPDATE tree SET lft = lft-$1 WHERE lft>=$2)
[71] SELECT_LAST_RESULT
[72] DBSTM_BIND_SEL_IDX COLIDX 6
[73] SELECT_LAST_RESULT
[74] DBSTM_BIND_SEL_IDX COLIDX 5
[75] DBSTM_EXEC
[76] RESULT_SET_INIT
[77] DBSTM_START STM (UPDATE tree SET rgt = rgt-$1 WHERE rgt>$2)
[78] SELECT_LAST_RESULT
[79] DBSTM_BIND_SEL_IDX COLIDX 6
[80] SELECT_LAST_RESULT
[81] DBSTM_BIND_SEL_IDX COLIDX 5
[82] DBSTM_EXEC
[83] RETURN
END

TRANSACTION treeCopyNode
BEGIN
Code:
[0] RESULT_SET_INIT
[1] RESULT_CONSTRAINT_UNIQUE
[2] RESULT_CONSTRAINT_UNIQUE
[3] DBSTM_START STM (SELECT lft,rgt FROM tree WHERE ID = $1)
[4] DBSTM_BIND_PATH PATH newparentid
[5] DBSTM_EXEC
[6] RESULT_SET_INIT
[7] RESULT_CONSTRAINT_UNIQUE
[8] RESULT_CONSTRAINT_UNIQUE
[9] DBSTM_START STM (SELECT $1,rgt-lft AS width FROM tree WHERE ID = $2 AND NOT ($3 >= lft AND $4 < rgt))
[10] SELECT_LAST_RESULT
[11] DBSTM_BIND_SEL_IDX COLIDX 1
[12] DBSTM_BIND_PATH PATH nodeid
[13] SELECT_LAST_RESULT
[14] DBSTM_BIND_SEL_IDX COLIDX 1
[15] SELECT_LAST_RESULT
[16] DBSTM_BIND_SEL_IDX COLIDX 2
[17] DBSTM_EXEC
[18] RESULT_SET_INIT
[19] DBSTM_START STM (UPDATE tree SET rgt = rgt + $1 WHERE rgt >= $2)
[20] SELECT_LAST_RESULT
[21] DBSTM_BIND_SEL_IDX COLIDX 2
[22] SELECT_LAST_RESULT
[23] DBSTM_BIND_SEL_IDX COLIDX 1
[24] DBSTM_EXEC
[25] RESULT_SET_INIT
[26] DBSTM_START STM (UPDATE tree SET lft = lft + $1 WHERE lft > $2)
[27] SELECT_LAST_RESULT
[28] DBSTM_BIND_SEL_IDX COLIDX 2
[29] SELECT_LAST_RESULT
[30] DBSTM_BIND_SEL_IDX COLIDX 1
[31] DBSTM_EXEC
[32] RESULT_SET_INIT
[33] RESULT_CONSTRAINT_UNIQUE
[34] RESULT_CONSTRAINT_UNIQUE
[35] DBSTM_START STM (SELECT lft,rgt,rgt-lft AS width FROM tree WHERE ID = $1)
[36] DBSTM_BIND_PATH PATH newparentid
[37] DBSTM_EXEC
[38] RESULT_SET_INIT
[39] RESULT_CONSTRAINT_UNIQUE
[40] RESULT_CONSTRAINT_UNIQUE
[41] DBSTM_START STM (SELECT $1,$2,$3,lft,rgt,rgt-lft AS width FROM tree WHERE ID = $4)
[42] SELECT_LAST_RESULT
[43] DBSTM_BIND_SEL_IDX COLIDX 1
[44] SELECT_LAST_RESULT
[45] DBSTM_BIND_SEL_IDX COLIDX 2
[46] SELECT_LAST_RESULT
[47] DBSTM_BIND_SEL_IDX COLIDX 3
[48] DBSTM_BIND_PATH PATH nodeid
[49] DBSTM_EXEC
[50] RESULT_SET_INIT
[51] DBSTM_START STM (INSERT INTO TREE
		SELECT P1.ID AS "ID",
			P1.parent AS parent,
			P1.lgt-$1+$2 AS lgt,
			P1.rgt-$3+$4 AS rgt,
			P1.name AS name
		FROM tree AS P1, tree AS P2
		WHERE P1.lft BETWEEN P2.lft AND P2.rgt AND P2.ID = $5)
[52] SELECT_LAST_RESULT
[53] DBSTM_BIND_SEL_IDX COLIDX 4
[54] SELECT_LAST_RESULT
[55] DBSTM_BIND_SEL_IDX COLIDX 1
[56] SELECT_LAST_RESULT
[57] DBSTM_BIND_SEL_IDX COLIDX 5
[58] SELECT_LAST_RESULT
[59] DBSTM_BIND_SEL_IDX COLIDX 2
[60] DBSTM_BIND_PATH PATH nodeid
[61] DBSTM_EXEC
[62] RETURN
END

